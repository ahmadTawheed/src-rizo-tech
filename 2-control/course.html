<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لوحة تحكم الخبير الزراعي</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800;900&family=Almarai:wght@300;400;700;800&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#1a5f2a',
                        secondary: '#2d8a3e',
                        accent: '#c4a35a',
                        dark: '#0d1f12',
                        light: '#f4f7f0',
                        card: '#ffffff',
                        border: '#d4e5d7',
                        muted: '#6b7c6e',
                        success: '#22c55e',
                        warning: '#eab308',
                        danger: '#ef4444'
                    },
                    fontFamily: {
                        display: ['Almarai', 'sans-serif'],
                        body: ['Tajawal', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <style>
        :root {
            --bg: #0d1f12;
            --fg: #f4f7f0;
            --muted: #6b7c6e;
            --accent: #c4a35a;
            --card: #ffffff;
            --border: #d4e5d7;
            --primary: #1a5f2a;
            --secondary: #2d8a3e;
        }

        * { font-family: 'Tajawal', sans-serif; }
        h1, h2, h3, h4, h5, h6, .font-display { font-family: 'Almarai', sans-serif; }

        body {
            background: linear-gradient(135deg, #0d1f12 0%, #1a3a1f 50%, #0d1f12 100%);
            min-height: 100vh;
        }

        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: rgba(26, 95, 42, 0.1); border-radius: 10px; }
        ::-webkit-scrollbar-thumb { background: linear-gradient(180deg, #1a5f2a, #2d8a3e); border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: linear-gradient(180deg, #2d8a3e, #1a5f2a); }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideInRight {
            from { opacity: 0; transform: translateX(-30px); }
            to { opacity: 1; transform: translateX(0); }
        }

        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        .animate-fade-in-up { animation: fadeInUp 0.6s ease-out forwards; }
        .animate-slide-in-right { animation: slideInRight 0.5s ease-out forwards; }

        .glass {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
        }

        .sidebar {
            background: linear-gradient(180deg, rgba(26, 95, 42, 0.95) 0%, rgba(13, 31, 18, 0.98) 100%);
            backdrop-filter: blur(30px);
        }

        .sidebar-item {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .sidebar-item::before {
            content: '';
            position: absolute;
            right: 0;
            top: 0;
            height: 100%;
            width: 0;
            background: linear-gradient(90deg, transparent, rgba(196, 163, 90, 0.2));
            transition: width 0.3s ease;
        }

        .sidebar-item:hover::before,
        .sidebar-item.active::before { width: 100%; }

        .sidebar-item.active {
            background: linear-gradient(90deg, rgba(196, 163, 90, 0.2), transparent);
            border-right: 3px solid #c4a35a;
        }

        .card-hover { transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }

        .btn-primary {
            background: linear-gradient(135deg, #1a5f2a 0%, #2d8a3e 100%);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(26, 95, 42, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #c4a35a 0%, #d4b76a 100%);
            color: #0d1f12;
            transition: all 0.3s ease;
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(196, 163, 90, 0.4);
        }

        .input-field {
            transition: all 0.3s ease;
            border: 2px solid #d4e5d7;
        }

        .input-field:focus {
            border-color: #1a5f2a;
            box-shadow: 0 0 0 4px rgba(26, 95, 42, 0.1);
            outline: none;
        }

        .file-upload {
            border: 2px dashed #d4e5d7;
            transition: all 0.3s ease;
        }

        .file-upload:hover,
        .file-upload.dragover {
            border-color: #1a5f2a;
            background: rgba(26, 95, 42, 0.05);
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(244, 247, 240, 0.9) 100%);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: radial-gradient(circle, rgba(26, 95, 42, 0.1) 0%, transparent 70%);
            transform: translate(30%, -30%);
        }

        .modal-overlay {
            background: rgba(13, 31, 18, 0.8);
            backdrop-filter: blur(10px);
        }

        .modal-content { animation: fadeInUp 0.4s ease-out; }

        .content-section { display: none; }
        .content-section.active { display: block; }

        .image-preview { position: relative; overflow: hidden; }
        .image-preview .delete-btn {
            position: absolute;
            top: 8px;
            left: 8px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .image-preview:hover .delete-btn { opacity: 1; }

        .checkbox-custom {
            appearance: none;
            width: 20px;
            height: 20px;
            border: 2px solid #d4e5d7;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .checkbox-custom:checked {
            background: #1a5f2a;
            border-color: #1a5f2a;
        }

        .checkbox-custom:checked::after {
            content: '';
            position: absolute;
            top: 2px;
            right: 6px;
            width: 5px;
            height: 10px;
            border: solid white;
            border-width: 0 2px 2px 0;
            transform: rotate(45deg);
        }

        .tab-btn { transition: all 0.3s ease; }
        .tab-btn.active {
            background: #1a5f2a;
            color: white;
        }

        .toast { animation: slideInRight 0.5s ease-out; }

        @media (max-width: 1024px) {
            .sidebar {
                transform: translateX(100%);
                transition: transform 0.3s ease;
            }
            .sidebar.open { transform: translateX(0); }
        }

        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</head>
<body class="text-dark font-body">
    <button id="mobileMenuBtn" class="lg:hidden fixed top-4 right-4 z-50 p-3 bg-primary text-white rounded-xl shadow-lg">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
        </svg>
    </button>

    <div id="toastContainer" class="fixed top-4 left-4 z-50 flex flex-col gap-2"></div>

    <div class="flex min-h-screen">
        <aside id="sidebar" class="sidebar fixed lg:static inset-y-0 right-0 w-72 z-40 flex flex-col">
            <div class="p-6 border-b border-white/10">
                <div class="flex items-center gap-3">
                    <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-accent to-yellow-600 flex items-center justify-center">
                        <svg class="w-7 h-7 text-dark" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                        </svg>
                    </div>
                    <div>
                        <h1 class="font-display text-xl font-bold text-white">زراعة أكاديمي</h1>
                        <p class="text-xs text-white/60">لوحة تحكم الخبير</p>
                    </div>
                </div>
            </div>

            <nav class="flex-1 py-6 overflow-y-auto">
                <ul class="space-y-1 px-3">
                    <li>
                        <button class="sidebar-item active w-full flex items-center gap-3 px-4 py-3 text-white/90 rounded-xl" data-section="profile">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                            </svg>
                            <span class="font-medium">عن الخبير</span>
                        </button>
                    </li>
                    <li>
                        <button class="sidebar-item w-full flex items-center gap-3 px-4 py-3 text-white/90 rounded-xl" data-section="courses">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
                            </svg>
                            <span class="font-medium">الكورسات</span>
                        </button>
                    </li>
                    <li>
                        <button class="sidebar-item w-full flex items-center gap-3 px-4 py-3 text-white/90 rounded-xl" data-section="statistics">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                            </svg>
                            <span class="font-medium">إحصائيات</span>
                        </button>
                    </li>
                    <li>
                        <button class="sidebar-item w-full flex items-center gap-3 px-4 py-3 text-white/90 rounded-xl" data-section="earnings">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            <span class="font-medium">الأرباح</span>
                        </button>
                    </li>
                    <li>
                        <button class="sidebar-item w-full flex items-center gap-3 px-4 py-3 text-white/90 rounded-xl" data-section="comments">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                            </svg>
                            <span class="font-medium">التعليقات</span>
                            <span id="commentsBadge" class="bg-danger text-white text-xs px-2 py-0.5 rounded-full">3</span>
                        </button>
                    </li>
                    <li>
                        <button class="sidebar-item w-full flex items-center gap-3 px-4 py-3 text-white/90 rounded-xl" data-section="reviews">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/>
                            </svg>
                            <span class="font-medium">التقييمات</span>
                        </button>
                    </li>
                    <li>
                        <button class="sidebar-item w-full flex items-center gap-3 px-4 py-3 text-white/90 rounded-xl" data-section="tests">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/>
                            </svg>
                            <span class="font-medium">الاختبارات</span>
                        </button>
                    </li>
                </ul>
            </nav>

            <div class="p-4 border-t border-white/10">
                <div class="flex items-center gap-3">
                    <div id="userAvatar" class="w-10 h-10 rounded-full bg-accent/20 flex items-center justify-center">
                        <svg class="w-5 h-5 text-accent" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                        </svg>
                    </div>
                    <div class="flex-1">
                        <p id="sidebarUserName" class="text-white font-medium text-sm">د. أحمد محمد</p>
                        <p class="text-white/50 text-xs">خبير زراعي</p>
                    </div>
                </div>
            </div>
        </aside>

        <div id="sidebarOverlay" class="fixed inset-0 bg-black/50 z-30 lg:hidden hidden"></div>

        <main class="flex-1 lg:mr-0 p-4 lg:p-8">
            <div class="max-w-7xl mx-auto">
                
                <!-- Profile Section -->
                <section id="profile" class="content-section active">
                    <div class="animate-fade-in-up">
                        <div class="mb-8">
                            <h2 class="font-display text-3xl font-bold text-white mb-2">عن الخبير</h2>
                            <p class="text-white/60">أكمل ملفك الشخصي لبناء الثقة مع الطلاب</p>
                        </div>

                        <div class="grid lg:grid-cols-2 gap-8">
                            <div class="glass rounded-2xl p-6 shadow-xl card-hover">
                                <div class="flex items-center gap-3 mb-6">
                                    <div class="w-10 h-10 rounded-xl bg-primary/10 flex items-center justify-center">
                                        <svg class="w-5 h-5 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                                        </svg>
                                    </div>
                                    <h3 class="font-display text-xl font-bold text-dark">المعلومات الأساسية</h3>
                                </div>

                                <div class="space-y-5">
                                    <div>
                                        <label class="block text-sm font-medium text-muted mb-2">اللقب العلمي <span class="text-danger">*</span></label>
                                        <input type="text" id="expertTitle" value="د. أحمد محمد السيد" placeholder="مثال: د. أحمد محمد" 
                                            class="input-field w-full px-4 py-3 rounded-xl bg-light text-dark placeholder-muted/50">
                                        <p class="text-xs text-muted mt-2 flex items-center gap-1">
                                            <svg class="w-4 h-4 text-primary" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                                            </svg>
                                            اللقب يساعد الطلاب على التعرف عليك وبناء الثقة
                                        </p>
                                    </div>

                                    <div>
                                        <label class="block text-sm font-medium text-muted mb-2">الخبرة التعليمية <span class="text-danger">*</span></label>
                                        <textarea id="expertEducation" rows="4" maxlength="200" 
                                            class="input-field w-full px-4 py-3 rounded-xl bg-light text-dark placeholder-muted/50 resize-none">خريج كلية الزراعة - جامعة القاهرة، تخصص وقاية نباتات. خبرة 15 عاماً في مجال المكافحة الحيوية والمتكاملة للآفات الزراعية. عملت كباحث رئيسي في مركز البحوث الزراعية.</textarea>
                                        <div class="flex justify-between items-center mt-2">
                                            <p class="text-xs text-muted flex items-center gap-1">
                                                <svg class="w-4 h-4 text-primary" fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                                                </svg>
                                                اذكر جامعتك وتخصصك وسنوات الخبرة
                                            </p>
                                            <span id="charCount" class="text-xs text-muted">152/200</span>
                                        </div>
                                    </div>

                                    <button onclick="saveExpertInfo()" class="btn-primary w-full py-3 rounded-xl text-white font-bold">
                                        حفظ المعلومات
                                    </button>
                                </div>
                            </div>

                            <div class="glass rounded-2xl p-6 shadow-xl card-hover">
                                <div class="flex items-center gap-3 mb-6">
                                    <div class="w-10 h-10 rounded-xl bg-accent/10 flex items-center justify-center">
                                        <svg class="w-5 h-5 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                        </svg>
                                    </div>
                                    <div>
                                        <h3 class="font-display text-xl font-bold text-dark">معرض الأعمال</h3>
                                        <p class="text-xs text-muted">ارفع 5-7 صور من أعمالك</p>
                                    </div>
                                </div>

                                <div class="file-upload rounded-xl p-8 text-center cursor-pointer mb-4" onclick="document.getElementById('portfolioImages').click()">
                                    <input type="file" id="portfolioImages" accept="image/*" multiple class="hidden" onchange="handlePortfolioUpload(event)">
                                    <svg class="w-12 h-12 mx-auto text-muted mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
                                    </svg>
                                    <p class="text-muted font-medium">اضغط أو اسحب الصور هنا</p>
                                    <p class="text-xs text-muted/70 mt-1">PNG, JPG, WEBP - حد أقصى 5MB</p>
                                </div>

                                <div id="portfolioPreview" class="grid grid-cols-3 gap-3">
                                    <div class="image-preview relative rounded-xl overflow-hidden aspect-square bg-gradient-to-br from-primary/20 to-secondary/20">
                                        <div class="w-full h-full flex items-center justify-center text-primary">
                                            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                            </svg>
                                        </div>
                                        <button onclick="deletePortfolioImage(0)" class="delete-btn absolute top-2 left-2 w-8 h-8 rounded-lg bg-danger text-white flex items-center justify-center hover:bg-red-600 transition-colors">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Courses Section -->
                <section id="courses" class="content-section">
                    <div class="animate-fade-in-up">
                        <div class="flex flex-col lg:flex-row lg:items-center justify-between gap-4 mb-8">
                            <div>
                                <h2 class="font-display text-3xl font-bold text-white mb-2">إدارة الكورسات</h2>
                                <p class="text-white/60">أنشئ وأدر كورساتك الزراعية</p>
                            </div>
                            <div class="flex gap-3">
                                <div class="relative">
                                    <input type="text" id="courseSearch" placeholder="بحث في الكورسات..." 
                                        class="input-field pl-10 pr-4 py-2.5 rounded-xl bg-white/90 text-dark placeholder-muted/50 w-64"
                                        oninput="searchCourses(this.value)">
                                    <svg class="w-5 h-5 text-muted absolute left-3 top-1/2 -translate-y-1/2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                                    </svg>
                                </div>
                                <button onclick="openCourseModal()" class="btn-primary px-6 py-2.5 rounded-xl text-white font-bold flex items-center gap-2">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                                    </svg>
                                    كورس جديد
                                </button>
                            </div>
                        </div>

                        <div id="coursesList" class="grid md:grid-cols-2 xl:grid-cols-3 gap-6"></div>
                    </div>
                </section>

                <!-- Statistics Section -->
                <section id="statistics" class="content-section">
                    <div class="animate-fade-in-up">
                        <div class="mb-8">
                            <h2 class="font-display text-3xl font-bold text-white mb-2">الإحصائيات</h2>
                            <p class="text-white/60">نظرة شاملة على أداء كورساتك</p>
                        </div>

                        <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                            <div class="stat-card rounded-2xl p-6 shadow-lg card-hover">
                                <div class="flex items-center gap-4">
                                    <div class="w-14 h-14 rounded-2xl bg-primary/10 flex items-center justify-center">
                                        <svg class="w-7 h-7 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
                                        </svg>
                                    </div>
                                    <div>
                                        <p class="text-sm text-muted">إجمالي الطلاب</p>
                                        <p id="statStudents" class="text-3xl font-bold text-dark">247</p>
                                    </div>
                                </div>
                            </div>

                            <div class="stat-card rounded-2xl p-6 shadow-lg card-hover">
                                <div class="flex items-center gap-4">
                                    <div class="w-14 h-14 rounded-2xl bg-accent/10 flex items-center justify-center">
                                        <svg class="w-7 h-7 text-accent" fill="currentColor" viewBox="0 0 24 24">
                                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                                        </svg>
                                    </div>
                                    <div>
                                        <p class="text-sm text-muted">متوسط التقييم</p>
                                        <p id="statRating" class="text-3xl font-bold text-dark">4.5</p>
                                    </div>
                                </div>
                            </div>

                            <div class="stat-card rounded-2xl p-6 shadow-lg card-hover">
                                <div class="flex items-center gap-4">
                                    <div class="w-14 h-14 rounded-2xl bg-secondary/10 flex items-center justify-center">
                                        <svg class="w-7 h-7 text-secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                                        </svg>
                                    </div>
                                    <div>
                                        <p class="text-sm text-muted">إجمالي الاختبارات</p>
                                        <p id="statTests" class="text-3xl font-bold text-dark">3</p>
                                    </div>
                                </div>
                            </div>

                            <div class="stat-card rounded-2xl p-6 shadow-lg card-hover">
                                <div class="flex items-center gap-4">
                                    <div class="w-14 h-14 rounded-2xl bg-blue-500/10 flex items-center justify-center">
                                        <svg class="w-7 h-7 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                                        </svg>
                                    </div>
                                    <div>
                                        <p class="text-sm text-muted">إجمالي التعليقات</p>
                                        <p id="statComments" class="text-3xl font-bold text-dark">18</p>
                                    </div>
                                </div>
                            </div>

                            <div class="stat-card rounded-2xl p-6 shadow-lg card-hover">
                                <div class="flex items-center gap-4">
                                    <div class="w-14 h-14 rounded-2xl bg-success/10 flex items-center justify-center">
                                        <svg class="w-7 h-7 text-success" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                        </svg>
                                    </div>
                                    <div>
                                        <p class="text-sm text-muted">إجمالي الأرباح</p>
                                        <p id="statEarnings" class="text-3xl font-bold text-dark">24,500 <span class="text-sm font-normal">ج.م</span></p>
                                    </div>
                                </div>
                            </div>

                            <div class="stat-card rounded-2xl p-6 shadow-lg card-hover">
                                <div class="flex items-center gap-4">
                                    <div class="w-14 h-14 rounded-2xl bg-purple-500/10 flex items-center justify-center">
                                        <svg class="w-7 h-7 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                        </svg>
                                    </div>
                                    <div>
                                        <p class="text-sm text-muted">ساعات المشاهدة</p>
                                        <p id="statHours" class="text-3xl font-bold text-dark">342</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="glass rounded-2xl p-6 shadow-lg">
                            <h3 class="font-display text-xl font-bold text-dark mb-6">تسجيل الطلاب الشهري</h3>
                            <div class="h-64 flex items-end justify-between gap-2">
                                <div class="flex-1 flex flex-col items-center">
                                    <div class="w-full bg-primary/30 rounded-t-lg transition-all hover:bg-primary/50" style="height: 35%"></div>
                                    <span class="text-xs text-muted mt-2">يناير</span>
                                </div>
                                <div class="flex-1 flex flex-col items-center">
                                    <div class="w-full bg-primary/40 rounded-t-lg transition-all hover:bg-primary/60" style="height: 50%"></div>
                                    <span class="text-xs text-muted mt-2">فبراير</span>
                                </div>
                                <div class="flex-1 flex flex-col items-center">
                                    <div class="w-full bg-primary/50 rounded-t-lg transition-all hover:bg-primary/70" style="height: 45%"></div>
                                    <span class="text-xs text-muted mt-2">مارس</span>
                                </div>
                                <div class="flex-1 flex flex-col items-center">
                                    <div class="w-full bg-primary/60 rounded-t-lg transition-all hover:bg-primary/80" style="height: 70%"></div>
                                    <span class="text-xs text-muted mt-2">أبريل</span>
                                </div>
                                <div class="flex-1 flex flex-col items-center">
                                    <div class="w-full bg-primary/70 rounded-t-lg transition-all hover:bg-primary/90" style="height: 85%"></div>
                                    <span class="text-xs text-muted mt-2">مايو</span>
                                </div>
                                <div class="flex-1 flex flex-col items-center">
                                    <div class="w-full bg-primary rounded-t-lg" style="height: 90%"></div>
                                    <span class="text-xs text-muted mt-2">يونيو</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Earnings Section -->
                <section id="earnings" class="content-section">
                    <div class="animate-fade-in-up">
                        <div class="mb-8">
                            <h2 class="font-display text-3xl font-bold text-white mb-2">الأرباح</h2>
                            <p class="text-white/60">إدارة أرباحك وسحبها</p>
                        </div>

                        <div class="grid lg:grid-cols-3 gap-6 mb-8">
                            <div class="glass rounded-2xl p-6 shadow-lg">
                                <h3 class="text-sm text-muted mb-2">إجمالي الأرباح</h3>
                                <p class="text-4xl font-bold text-dark">24,500 <span class="text-lg font-normal">ج.م</span></p>
                            </div>
                            <div class="glass rounded-2xl p-6 shadow-lg">
                                <h3 class="text-sm text-muted mb-2">الرصيد المتاح</h3>
                                <p class="text-4xl font-bold text-success">22,050 <span class="text-lg font-normal">ج.م</span></p>
                            </div>
                            <div class="glass rounded-2xl p-6 shadow-lg">
                                <h3 class="text-sm text-muted mb-2">الرصيد المعلق</h3>
                                <p class="text-4xl font-bold text-warning">2,450 <span class="text-lg font-normal">ج.م</span></p>
                            </div>
                        </div>

                        <div class="glass rounded-2xl p-6 shadow-lg mb-8">
                            <h3 class="font-display text-xl font-bold text-dark mb-6">سحب الأرباح</h3>
                            <div class="grid lg:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-sm font-medium text-muted mb-2">طريقة السحب</label>
                                    <select id="withdrawMethod" class="input-field w-full px-4 py-3 rounded-xl bg-light text-dark">
                                        <option value="">اختر طريقة السحب</option>
                                        <option value="visa">فيزا / ماستركارد</option>
                                        <option value="paypal">باي بال</option>
                                        <option value="vodafone">فودافون كاش</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-muted mb-2">المبلغ</label>
                                    <input type="number" id="withdrawAmount" placeholder="أدخل المبلغ" 
                                        class="input-field w-full px-4 py-3 rounded-xl bg-light text-dark placeholder-muted/50">
                                </div>
                            </div>
                            <div id="withdrawDetails" class="mt-4 hidden">
                                <div id="visaFields" class="hidden">
                                    <label class="block text-sm font-medium text-muted mb-2">رقم البطاقة</label>
                                    <input type="text" placeholder="XXXX XXXX XXXX XXXX" maxlength="19"
                                        class="input-field w-full px-4 py-3 rounded-xl bg-light text-dark placeholder-muted/50">
                                </div>
                                <div id="paypalFields" class="hidden">
                                    <label class="block text-sm font-medium text-muted mb-2">البريد الإلكتروني</label>
                                    <input type="email" placeholder="email@example.com"
                                        class="input-field w-full px-4 py-3 rounded-xl bg-light text-dark placeholder-muted/50">
                                </div>
                                <div id="vodafoneFields" class="hidden">
                                    <label class="block text-sm font-medium text-muted mb-2">رقم المحفظة</label>
                                    <input type="tel" placeholder="01XXXXXXXXX"
                                        class="input-field w-full px-4 py-3 rounded-xl bg-light text-dark placeholder-muted/50">
                                </div>
                            </div>
                            <button onclick="requestWithdraw()" class="btn-primary w-full mt-6 py-3 rounded-xl text-white font-bold">
                                طلب السحب
                            </button>
                        </div>

                        <div class="glass rounded-2xl p-6 shadow-lg">
                            <h3 class="font-display text-xl font-bold text-dark mb-6">سجل المعاملات</h3>
                            <div id="transactionsList" class="space-y-3"></div>
                        </div>
                    </div>
                </section>

                <!-- Comments Section -->
                <section id="comments" class="content-section">
                    <div class="animate-fade-in-up">
                        <div class="mb-8">
                            <h2 class="font-display text-3xl font-bold text-white mb-2">التعليقات</h2>
                            <p class="text-white/60">الرد على تعليقات الطلاب</p>
                        </div>
                        <div id="commentsList" class="space-y-4"></div>
                    </div>
                </section>

                <!-- Reviews Section -->
                <section id="reviews" class="content-section">
                    <div class="animate-fade-in-up">
                        <div class="mb-8">
                            <h2 class="font-display text-3xl font-bold text-white mb-2">التقييمات</h2>
                            <p class="text-white/60">تقييمات الكورسات من الطلاب</p>
                        </div>
                        <div id="reviewsList" class="space-y-6"></div>
                    </div>
                </section>

                <!-- Tests Section -->
                <section id="tests" class="content-section">
                    <div class="animate-fade-in-up">
                        <div class="flex flex-col lg:flex-row lg:items-center justify-between gap-4 mb-8">
                            <div>
                                <h2 class="font-display text-3xl font-bold text-white mb-2">الاختبارات</h2>
                                <p class="text-white/60">أنشئ اختبارات لكورساتك</p>
                            </div>
                            <div class="flex gap-3">
                                <div class="relative">
                                    <input type="text" id="testSearch" placeholder="بحث في الاختبارات..." 
                                        class="input-field pl-10 pr-4 py-2.5 rounded-xl bg-white/90 text-dark placeholder-muted/50 w-64"
                                        oninput="searchTests(this.value)">
                                    <svg class="w-5 h-5 text-muted absolute left-3 top-1/2 -translate-y-1/2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                                    </svg>
                                </div>
                                <button onclick="openTestModal()" class="btn-primary px-6 py-2.5 rounded-xl text-white font-bold flex items-center gap-2">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                                    </svg>
                                    اختبار جديد
                                </button>
                            </div>
                        </div>

                        <div class="glass rounded-2xl p-6 mb-8 border-r-4 border-accent">
                            <div class="flex gap-4">
                                <div class="w-12 h-12 rounded-xl bg-accent/10 flex items-center justify-center flex-shrink-0">
                                    <svg class="w-6 h-6 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                    </svg>
                                </div>
                                <div>
                                    <h4 class="font-display font-bold text-dark mb-1">أهمية الاختبارات</h4>
                                    <p class="text-muted text-sm">إضافة اختبارات للكورسات تزيد من تقييم الكورس وتجعله أكثر احترافية. الطلاب يفضلون الكورسات التي تحتوي على اختبارات لقياس مدى استيعابهم للمحتوى.</p>
                                </div>
                            </div>
                        </div>

                        <div id="testsList" class="grid md:grid-cols-2 gap-6"></div>
                    </div>
                </section>

            </div>
        </main>
    </div>

    <!-- Course Modal -->
    <div id="courseModal" class="fixed inset-0 z-50 hidden">
        <div class="modal-overlay absolute inset-0" onclick="closeCourseModal()"></div>
        <div class="modal-content absolute inset-4 lg:inset-10 glass rounded-2xl overflow-hidden flex flex-col">
            <div class="p-6 border-b border-border flex items-center justify-between">
                <h3 id="courseModalTitle" class="font-display text-2xl font-bold text-dark">إنشاء كورس جديد</h3>
                <button onclick="closeCourseModal()" class="w-10 h-10 rounded-xl bg-muted/10 flex items-center justify-center hover:bg-muted/20 transition-colors">
                    <svg class="w-5 h-5 text-muted" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>

            <div class="flex-1 overflow-y-auto p-6">
                <div class="flex gap-2 mb-6 overflow-x-auto pb-2">
                    <button class="tab-btn active px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap" data-tab="courseInfo">معلومات الكورس</button>
                    <button class="tab-btn px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap bg-light" data-tab="courseLessons">الدروس</button>
                    <button class="tab-btn px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap bg-light" data-tab="coursePreview">المعاينة</button>
                </div>

                <div id="courseInfoTab" class="tab-content">
                    <div class="grid lg:grid-cols-2 gap-6">
                        <div class="space-y-5">
                            <div>
                                <label class="block text-sm font-medium text-dark mb-2">عنوان الكورس <span class="text-danger">*</span></label>
                                <input type="text" id="courseTitle" placeholder="مثال: أساسيات الري الحديث" maxlength="50"
                                    class="input-field w-full px-4 py-3 rounded-xl bg-light text-dark placeholder-muted/50">
                                <p class="text-xs text-muted mt-1">4-5 كلمات كحد أقصى</p>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-dark mb-2">وصف مختصر <span class="text-danger">*</span></label>
                                <textarea id="courseShortDesc" rows="2" maxlength="70" placeholder="وصف مختصر للكورس..."
                                    class="input-field w-full px-4 py-3 rounded-xl bg-light text-dark placeholder-muted/50 resize-none"></textarea>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-dark mb-2">وصف تفصيلي <span class="text-danger">*</span></label>
                                <textarea id="courseLongDesc" rows="4" placeholder="وصف تفصيلي عن محتوى الكورس..."
                                    class="input-field w-full px-4 py-3 rounded-xl bg-light text-dark placeholder-muted/50 resize-none"></textarea>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-dark mb-2">التخصص <span class="text-danger">*</span></label>
                                <select id="courseCategory" class="input-field w-full px-4 py-3 rounded-xl bg-light text-dark">
                                    <option value="">اختر التخصص</option>
                                    <option value="irrigation">الري والتسميد</option>
                                    <option value="protection">وقاية النباتات</option>
                                    <option value="soil">علوم التربة</option>
                                    <option value="horticulture">البستنة</option>
                                    <option value="animal">الإنتاج الحيواني</option>
                                    <option value="poultry">الدواجن</option>
                                    <option value="fish">الأسماك</option>
                                    <option value="organic">الزراعة العضوية</option>
                                </select>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-dark mb-2">السعر (ج.م) <span class="text-danger">*</span></label>
                                <input type="number" id="coursePrice" placeholder="0"
                                    class="input-field w-full px-4 py-3 rounded-xl bg-light text-dark placeholder-muted/50">
                                <div class="mt-2 p-3 bg-warning/10 rounded-lg">
                                    <p class="text-xs text-warning flex items-center gap-1">
                                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                                        </svg>
                                        عمولة المنصة: 10% من سعر الكورس
                                    </p>
                                </div>
                            </div>
                        </div>

                        <div class="space-y-5">
                            <div>
                                <label class="block text-sm font-medium text-dark mb-2">ماذا سنتعلم؟ <span class="text-danger">*</span></label>
                                <div id="learningPoints" class="space-y-2"></div>
                                <button onclick="addLearningPoint()" class="mt-2 text-sm text-primary font-medium flex items-center gap-1 hover:text-secondary transition-colors">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                                    </svg>
                                    إضافة نقطة
                                </button>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-dark mb-2">صورة الكورس <span class="text-danger">*</span></label>
                                <div class="file-upload rounded-xl p-6 text-center cursor-pointer" onclick="document.getElementById('courseImage').click()">
                                    <input type="file" id="courseImage" accept="image/*" class="hidden" onchange="handleCourseImage(event)">
                                    <div id="courseImagePreview" class="hidden">
                                        <img id="courseImageImg" src="" alt="" class="w-full h-40 object-cover rounded-lg mb-2">
                                        <p class="text-sm text-muted">اضغط لتغيير الصورة</p>
                                    </div>
                                    <div id="courseImagePlaceholder">
                                        <svg class="w-10 h-10 mx-auto text-muted mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                        </svg>
                                        <p class="text-muted text-sm">اضغط لرفع صورة</p>
                                    </div>
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-dark mb-2">فيديو المقدمة المجانية</label>
                                <div class="file-upload rounded-xl p-6 text-center cursor-pointer" onclick="document.getElementById('courseVideo').click()">
                                    <input type="file" id="courseVideo" accept="video/*" class="hidden" onchange="handleCourseVideo(event)">
                                    <div id="courseVideoPreview" class="hidden">
                                        <video id="courseVideoEl" class="w-full h-40 object-cover rounded-lg mb-2" controls></video>
                                        <p class="text-sm text-muted">اضغط لتغيير الفيديو</p>
                                    </div>
                                    <div id="courseVideoPlaceholder">
                                        <svg class="w-10 h-10 mx-auto text-muted mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                                        </svg>
                                        <p class="text-muted text-sm">اضغط لرفع فيديو</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="courseLessonsTab" class="tab-content hidden">
                    <div class="space-y-4">
                        <div class="flex items-center justify-between">
                            <h4 class="font-display text-lg font-bold text-dark">الدروس</h4>
                            <button onclick="addLesson()" class="btn-secondary px-4 py-2 rounded-xl font-medium flex items-center gap-2">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                                </svg>
                                إضافة درس
                            </button>
                        </div>
                        <div id="lessonsContainer" class="space-y-4"></div>
                        <div id="noLessons" class="text-center py-12 hidden">
                            <svg class="w-16 h-16 mx-auto text-muted/30 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                            </svg>
                            <p class="text-muted">لم تُضف أي دروس بعد</p>
                            <button onclick="addLesson()" class="mt-4 text-primary font-medium hover:text-secondary transition-colors">أضف درسك الأول</button>
                        </div>
                    </div>
                </div>

                <div id="coursePreviewTab" class="tab-content hidden">
                    <div class="max-w-2xl mx-auto">
                        <div id="previewContent" class="glass rounded-2xl overflow-hidden shadow-xl"></div>
                    </div>
                </div>
            </div>

            <div class="p-6 border-t border-border flex justify-between">
                <button onclick="closeCourseModal()" class="px-6 py-2.5 rounded-xl bg-muted/10 text-muted font-medium hover:bg-muted/20 transition-colors">
                    إلغاء
                </button>
                <div class="flex gap-3">
                    <button onclick="saveCourseDraft()" class="px-6 py-2.5 rounded-xl bg-light text-dark font-medium border-2 border-border hover:border-primary transition-colors">
                        حفظ كمسودة
                    </button>
                    <button onclick="publishCourse()" class="btn-primary px-6 py-2.5 rounded-xl text-white font-bold">
                        نشر الكورس
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Test Modal -->
    <div id="testModal" class="fixed inset-0 z-50 hidden">
        <div class="modal-overlay absolute inset-0" onclick="closeTestModal()"></div>
        <div class="modal-content absolute inset-4 lg:inset-10 glass rounded-2xl overflow-hidden flex flex-col">
            <div class="p-6 border-b border-border flex items-center justify-between">
                <h3 id="testModalTitle" class="font-display text-2xl font-bold text-dark">إنشاء اختبار جديد</h3>
                <button onclick="closeTestModal()" class="w-10 h-10 rounded-xl bg-muted/10 flex items-center justify-center hover:bg-muted/20 transition-colors">
                    <svg class="w-5 h-5 text-muted" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>

            <div class="flex-1 overflow-y-auto p-6">
                <div class="max-w-3xl mx-auto space-y-6">
                    <div>
                        <label class="block text-sm font-medium text-dark mb-2">اختر الكورس <span class="text-danger">*</span></label>
                        <select id="testCourse" class="input-field w-full px-4 py-3 rounded-xl bg-light text-dark">
                            <option value="">اختر الكورس</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-dark mb-2">عدد الأسئلة <span class="text-danger">*</span></label>
                        <div class="flex items-center gap-4">
                            <input type="range" id="questionCount" min="10" max="20" value="10" 
                                class="flex-1 h-2 bg-light rounded-lg appearance-none cursor-pointer accent-primary"
                                oninput="updateQuestionCount(this.value)">
                            <span id="questionCountDisplay" class="text-lg font-bold text-primary w-16 text-center">10</span>
                        </div>
                    </div>

                    <div id="questionsContainer" class="space-y-4"></div>
                </div>
            </div>

            <div class="p-6 border-t border-border flex justify-between">
                <button onclick="closeTestModal()" class="px-6 py-2.5 rounded-xl bg-muted/10 text-muted font-medium hover:bg-muted/20 transition-colors">
                    إلغاء
                </button>
                <button onclick="saveTest()" class="btn-primary px-6 py-2.5 rounded-xl text-white font-bold">
                    حفظ الاختبار
                </button>
            </div>
        </div>
    </div>

    <!-- Reply Modal -->
    <div id="replyModal" class="fixed inset-0 z-50 hidden">
        <div class="modal-overlay absolute inset-0" onclick="closeReplyModal()"></div>
        <div class="modal-content absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-lg glass rounded-2xl overflow-hidden">
            <div class="p-6 border-b border-border">
                <h3 class="font-display text-xl font-bold text-dark">الرد على التعليق</h3>
            </div>
            <div class="p-6">
                <div id="originalComment" class="p-4 bg-light rounded-xl mb-4"></div>
                <textarea id="replyText" rows="3" placeholder="اكتب ردك هنا..."
                    class="input-field w-full px-4 py-3 rounded-xl bg-light text-dark placeholder-muted/50 resize-none"></textarea>
            </div>
            <div class="p-6 border-t border-border flex justify-end gap-3">
                <button onclick="closeReplyModal()" class="px-6 py-2.5 rounded-xl bg-muted/10 text-muted font-medium">إلغاء</button>
                <button onclick="submitReply()" class="btn-primary px-6 py-2.5 rounded-xl text-white font-bold">إرسال الرد</button>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="fixed inset-0 z-50 hidden">
        <div class="modal-overlay absolute inset-0" onclick="closeDeleteModal()"></div>
        <div class="modal-content absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-md glass rounded-2xl overflow-hidden">
            <div class="p-6 text-center">
                <div class="w-16 h-16 rounded-full bg-danger/10 flex items-center justify-center mx-auto mb-4">
                    <svg class="w-8 h-8 text-danger" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                    </svg>
                </div>
                <h3 class="font-display text-xl font-bold text-dark mb-2">تأكيد الحذف</h3>
                <p id="deleteMessage" class="text-muted mb-6">هل أنت متأكد من حذف هذا العنصر؟</p>
                <div class="flex justify-center gap-3">
                    <button onclick="closeDeleteModal()" class="px-6 py-2.5 rounded-xl bg-muted/10 text-muted font-medium">إلغاء</button>
                    <button id="confirmDeleteBtn" class="px-6 py-2.5 rounded-xl bg-danger text-white font-bold">حذف</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============== DATA STORE ==============
        let appData = {
            expert: {
                title: 'د. أحمد محمد السيد',
                education: 'خريج كلية الزراعة - جامعة القاهرة، تخصص وقاية نباتات. خبرة 15 عاماً في مجال المكافحة الحيوية والمتكاملة للآفات الزراعية. عملت كباحث رئيسي في مركز البحوث الزراعية.',
                portfolio: []
            },
            courses: [
                {
                    id: 1,
                    title: 'أساسيات الري الحديث',
                    shortDesc: 'تعلم أحدث تقنيات الري والترشيد من المياه في الزراعة',
                    longDesc: 'كورس شامل يغطي جميع جوانب الري الحديث من أنظمة الري بالتنقيط إلى الري بالرش، مع التركيز على ترشيد استهلاك المياه وتحسين كفاءة الري.',
                    category: 'irrigation',
                    price: 350,
                    learningPoints: ['أساسيات علم الري والتربة', 'أنظمة الري بالتنقيط', 'الري بالرش المحوري', 'ترشيد استهلاك المياه', 'صيانة أنظمة الري'],
                    image: null,
                    video: null,
                    lessons: [
                        { id: 1, title: 'مقدمة في علم الري', content: 'نبذة عن أهمية الري في الزراعة', hasScript: true, resources: [] },
                        { id: 2, title: 'أنواع أنظمة الري', content: 'شرح تفصيلي لأنواع أنظمة الري المختلفة', hasScript: false, resources: [] },
                        { id: 3, title: 'الري بالتنقيط', content: 'درس متخصص في الري بالتنقيط', hasScript: true, resources: [] }
                    ],
                    status: 'published',
                    createdAt: '2024-01-15',
                    students: 85,
                    rating: 4.7,
                    reviews: 23
                },
                {
                    id: 2,
                    title: 'المكافحة الحيوية للآفات',
                    shortDesc: 'دليلك الشامل للمكافحة الحيوية الآمنة للبيئة',
                    longDesc: 'تعلم كيفية مكافحة الآفات الزراعية بطرق بيولوجية آمنة وفعالة دون استخدام المبيدات الكيميائية الضارة.',
                    category: 'protection',
                    price: 450,
                    learningPoints: ['مفهوم المكافحة الحيوية', 'الأعداء الحيوية', 'الطُعم الجذابة', 'المبيدات الحيوية'],
                    image: null,
                    video: null,
                    lessons: [
                        { id: 1, title: 'مقدمة في المكافحة الحيوية', content: 'نبذة عن المكافحة الحيوية ومميزاتها', hasScript: true, resources: [] },
                        { id: 2, title: 'الأعداء الحيوية', content: 'أنواع الأعداء الحيوية واستخداماتها', hasScript: false, resources: [] }
                    ],
                    status: 'published',
                    createdAt: '2024-02-10',
                    students: 62,
                    rating: 4.5,
                    reviews: 18
                },
                {
                    id: 3,
                    title: 'الزراعة العضوية',
                    shortDesc: 'من الصفر للاحتراف في الزراعة العضوية',
                    longDesc: 'كورس متكامل عن الزراعة العضوية وكيفية التحول من الزراعة التقليدية إلى العضوية بشكل ناجح.',
                    category: 'organic',
                    price: 500,
                    learningPoints: ['أسس الزراعة العضوية', 'التسميد العضوي', 'مكافحة الآفات عضوياً', 'شهادات الزراعة العضوية'],
                    image: null,
                    video: null,
                    lessons: [
                        { id: 1, title: 'مدخل للزراعة العضوية', content: 'تعريف الزراعة العضوية وأهميتها', hasScript: true, resources: [] }
                    ],
                    status: 'draft',
                    createdAt: '2024-03-01',
                    students: 0,
                    rating: 0,
                    reviews: 0
                }
            ],
            tests: [
                {
                    id: 1,
                    courseId: 1,
                    questions: [
                        { question: 'ما هو أفضل وقت لري المحاصيل؟', answers: ['في الصباح الباكر', 'في الظهر', 'في المساء', 'في منتصف الليل'], correctAnswer: 0 },
                        { question: 'ما هي ميزة الري بالتنقيط؟', answers: ['تبخر كبير', 'توفير المياه', 'تكلفة عالية', 'تعقيد التركيب'], correctAnswer: 1 },
                        { question: 'ما هو الرش المحوري؟', answers: ['نوع من الأسمدة', 'نظام ري دائري', 'آلة حصاد', 'نوع من التربة'], correctAnswer: 1 }
                    ],
                    createdAt: '2024-01-20'
                },
                {
                    id: 2,
                    courseId: 2,
                    questions: [
                        { question: 'ما المقصود بالمكافحة الحيوية؟', answers: ['استخدام الكيماويات', 'استخدام الأعداء الطبيعيين', 'الري المنتظم', 'التسميد الزائد'], correctAnswer: 1 },
                        { question: 'ما هو الخنفساء؟', answers: ['نبات', 'عدو حيوي', 'سماد', 'تربة'], correctAnswer: 1 }
                    ],
                    createdAt: '2024-02-15'
                },
                {
                    id: 3,
                    courseId: 3,
                    questions: [
                        { question: 'ما هي الزراعة العضوية؟', answers: ['زراعة بالمبيدات', 'زراعة بدون كيماويات', 'زراءة مائية', 'زراعة صناعية'], correctAnswer: 1 }
                    ],
                    createdAt: '2024-03-05'
                }
            ],
            comments: [
                {
                    id: 1,
                    courseId: 1,
                    courseName: 'أساسيات الري الحديث',
                    lessonId: 1,
                    lessonName: 'مقدمة في علم الري',
                    userName: 'محمود علي',
                    text: 'شرح ممتاز جداً! هل يمكنكم تزويدي بمزيد من المعلومات عن أنظمة الري الذكية؟',
                    createdAt: '2024-03-10T10:30:00',
                    likes: 12,
                    reply: 'شكراً لك! نعم سأقوم بإضافة درس جديد قريباً عن أنظمة الري الذكية.'
                },
                {
                    id: 2,
                    courseId: 1,
                    courseName: 'أساسيات الري الحديث',
                    lessonId: 2,
                    lessonName: 'أنواع أنظمة الري',
                    userName: 'سارة أحمد',
                    text: 'هل يوجد ملف PDF للدرس؟ أحتاجه للمراجعة',
                    createdAt: '2024-03-12T14:15:00',
                    likes: 5,
                    reply: null
                },
                {
                    id: 3,
                    courseId: 2,
                    courseName: 'المكافحة الحيوية للآفات',
                    lessonId: 1,
                    lessonName: 'مقدمة في المكافحة الحيوية',
                    userName: 'خالد إبراهيم',
                    text: 'كورس رائع ومفيد جداً للمزارعين. شكراً دكتور أحمد!',
                    createdAt: '2024-03-14T09:00:00',
                    likes: 8,
                    reply: null
                },
                {
                    id: 4,
                    courseId: 2,
                    courseName: 'المكافحة الحيوية للآفات',
                    lessonId: 2,
                    lessonName: 'الأعداء الحيوية',
                    userName: 'فاطمة حسن',
                    text: 'هل يمكن استخدام الأساليب الحيوية في الزراعة المحمية؟',
                    createdAt: '2024-03-15T16:45:00',
                    likes: 3,
                    reply: 'نعم بالتأكيد! المكافحة الحيوية فعالة جداً في البيوت المحمية وسأشرح ذلك بالتفصيل في الدرس القادم.'
                }
            ],
            reviews: [
                { id: 1, courseId: 1, courseName: 'أساسيات الري الحديث', userName: 'أحمد محمد', rating: 5, text: 'أفضل كورس في الري! استفدت منه كثيراً في مزرعتي.', createdAt: '2024-03-01' },
                { id: 2, courseId: 1, courseName: 'أساسيات الري الحديث', userName: 'يوسف علي', rating: 4, text: 'كورس ممتاز لكن أتمنى إضافة المزيد من التطبيقات العملية.', createdAt: '2024-03-05' },
                { id: 3, courseId: 1, courseName: 'أساسيات الري الحديث', userName: 'عمر حسن', rating: 5, text: 'شرح واضح ومبسط. أنصح به بشدة!', createdAt: '2024-03-08' },
                { id: 4, courseId: 2, courseName: 'المكافحة الحيوية للآفات', userName: 'محمد سعيد', rating: 5, text: 'محتوى قيم ومعلومات جديدة تماماً بالنسبة لي.', createdAt: '2024-03-10' },
                { id: 5, courseId: 2, courseName: 'المكافحة الحيوية للآفات', userName: 'سلمى أحمد', rating: 4, text: 'كورس مفيد جداً للمهتمين بالزراعة العضوية.', createdAt: '2024-03-12' }
            ],
            transactions: [
                { id: 1, type: 'earning', method: null, amount: 5000, status: 'completed', createdAt: '2024-02-15', description: 'أرباح يناير' },
                { id: 2, type: 'withdraw', method: 'visa', amount: 3000, status: 'completed', createdAt: '2024-02-20', description: 'سحب إلى فيزا' },
                { id: 3, type: 'earning', method: null, amount: 8500, status: 'completed', createdAt: '2024-03-15', description: 'أرباح فبراير' },
                { id: 4, type: 'withdraw', method: 'vodafone', amount: 5000, status: 'pending', createdAt: '2024-03-18', description: 'سحب إلى فودافون كاش' }
            ],
            statistics: {
                totalStudents: 247,
                averageRating: 4.5,
                totalTests: 3,
                totalComments: 18,
                totalEarnings: 24500,
                watchHours: 342
            }
        };

        // Current editing states
        let currentCourseId = null;
        let currentTestId = null;
        let currentCommentId = null;
        let currentLessons = [];
        let currentCourseImage = null;
        let currentCourseVideo = null;
        let deleteCallback = null;

        // ============== INITIALIZATION ==============
        document.addEventListener('DOMContentLoaded', function() {
            initSidebar();
            initTabs();
            initWithdrawMethod();
            renderAll();
        });

        // ============== SIDEBAR NAVIGATION ==============
        function initSidebar() {
            const sidebarItems = document.querySelectorAll('.sidebar-item');
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            const mobileBtn = document.getElementById('mobileMenuBtn');

            sidebarItems.forEach(item => {
                item.addEventListener('click', function() {
                    const section = this.dataset.section;
                    
                    sidebarItems.forEach(i => i.classList.remove('active'));
                    this.classList.add('active');
                    
                    document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
                    document.getElementById(section).classList.add('active');
                    
                    if (window.innerWidth < 1024) {
                        sidebar.classList.remove('open');
                        overlay.classList.add('hidden');
                    }
                });
            });

            if (mobileBtn) {
                mobileBtn.addEventListener('click', function() {
                    sidebar.classList.toggle('open');
                    overlay.classList.toggle('hidden');
                });
            }

            if (overlay) {
                overlay.addEventListener('click', function() {
                    sidebar.classList.remove('open');
                    overlay.classList.add('hidden');
                });
            }
        }

        // ============== TABS ==============
        function initTabs() {
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const tab = this.dataset.tab;
                    
                    this.parentElement.querySelectorAll('.tab-btn').forEach(b => {
                        b.classList.remove('active');
                        b.classList.add('bg-light');
                    });
                    this.classList.add('active');
                    this.classList.remove('bg-light');
                    
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
                    document.getElementById(tab + 'Tab').classList.remove('hidden');
                    
                    if (tab === 'coursePreview') {
                        updateCoursePreview();
                    }
                });
            });
        }

        // ============== EXPERT PROFILE ==============
        function saveExpertInfo() {
            const title = document.getElementById('expertTitle').value.trim();
            const education = document.getElementById('expertEducation').value.trim();

            if (!title) {
                showToast('يرجى إدخال اللقب العلمي', 'error');
                return;
            }

            appData.expert.title = title;
            appData.expert.education = education;
            document.getElementById('sidebarUserName').textContent = title;
            showToast('تم حفظ المعلومات بنجاح', 'success');
        }

        document.getElementById('expertEducation')?.addEventListener('input', function() {
            document.getElementById('charCount').textContent = this.value.length + '/200';
        });

        function handlePortfolioUpload(event) {
            showToast('تم رفع الصورة بنجاح', 'success');
        }

        function deletePortfolioImage(index) {
            showToast('تم حذف الصورة', 'success');
        }

        // ============== COURSES ==============
        function openCourseModal(courseId = null) {
            currentCourseId = courseId;
            currentLessons = [];
            currentCourseImage = null;
            currentCourseVideo = null;

            document.getElementById('courseTitle').value = '';
            document.getElementById('courseShortDesc').value = '';
            document.getElementById('courseLongDesc').value = '';
            document.getElementById('courseCategory').value = '';
            document.getElementById('coursePrice').value = '';
            document.getElementById('learningPoints').innerHTML = '';
            
            document.getElementById('courseImagePreview').classList.add('hidden');
            document.getElementById('courseImagePlaceholder').classList.remove('hidden');
            document.getElementById('courseVideoPreview').classList.add('hidden');
            document.getElementById('courseVideoPlaceholder').classList.remove('hidden');
            document.getElementById('lessonsContainer').innerHTML = '';
            document.getElementById('noLessons').classList.remove('hidden');

            document.getElementById('courseModalTitle').textContent = courseId ? 'تعديل الكورس' : 'إنشاء كورس جديد';

            if (courseId) {
                const course = appData.courses.find(c => c.id === courseId);
                if (course) {
                    document.getElementById('courseTitle').value = course.title;
                    document.getElementById('courseShortDesc').value = course.shortDesc;
                    document.getElementById('courseLongDesc').value = course.longDesc;
                    document.getElementById('courseCategory').value = course.category;
                    document.getElementById('coursePrice').value = course.price;
                    
                    const pointsContainer = document.getElementById('learningPoints');
                    course.learningPoints.forEach((point, i) => {
                        addLearningPoint(point);
                    });
                    
                    currentLessons = JSON.parse(JSON.stringify(course.lessons));
                    renderLessons();
                }
            }

            if (document.getElementById('learningPoints').children.length === 0) {
                addLearningPoint();
            }

            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
                btn.classList.add('bg-light');
            });
            document.querySelector('.tab-btn[data-tab="courseInfo"]').classList.add('active');
            document.querySelector('.tab-btn[data-tab="courseInfo"]').classList.remove('bg-light');
            
            document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
            document.getElementById('courseInfoTab').classList.remove('hidden');

            document.getElementById('courseModal').classList.remove('hidden');
        }

        function closeCourseModal() {
            document.getElementById('courseModal').classList.add('hidden');
        }

        function addLearningPoint(value = '') {
            const container = document.getElementById('learningPoints');
            const count = container.children.length + 1;
            const newPoint = document.createElement('div');
            newPoint.className = 'flex gap-2';
            newPoint.innerHTML = `
                <input type="text" value="${value}" placeholder="نقطة التعلم ${count}" class="learning-point input-field flex-1 px-4 py-2 rounded-xl bg-light text-dark placeholder-muted/50">
                <button onclick="removeLearningPoint(this)" class="px-3 py-2 rounded-xl bg-danger/10 text-danger hover:bg-danger/20 transition-colors">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                    </svg>
                </button>
            `;
            container.appendChild(newPoint);
        }

        function removeLearningPoint(btn) {
            const container = document.getElementById('learningPoints');
            if (container.children.length > 1) {
                btn.parentElement.remove();
            }
        }

        function handleCourseImage(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    currentCourseImage = e.target.result;
                    document.getElementById('courseImageImg').src = e.target.result;
                    document.getElementById('courseImagePreview').classList.remove('hidden');
                    document.getElementById('courseImagePlaceholder').classList.add('hidden');
                };
                reader.readAsDataURL(file);
            }
        }

        function handleCourseVideo(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    currentCourseVideo = e.target.result;
                    document.getElementById('courseVideoEl').src = e.target.result;
                    document.getElementById('courseVideoPreview').classList.remove('hidden');
                    document.getElementById('courseVideoPlaceholder').classList.add('hidden');
                };
                reader.readAsDataURL(file);
            }
        }

        function addLesson() {
            document.getElementById('noLessons').classList.add('hidden');
            
            const lessonId = Date.now();
            const lesson = { id: lessonId, title: '', content: '', hasScript: false, resources: [] };
            currentLessons.push(lesson);
            
            const container = document.getElementById('lessonsContainer');
            const lessonEl = document.createElement('div');
            lessonEl.className = 'glass rounded-xl p-4 border-2 border-border';
            lessonEl.id = `lesson-${lessonId}`;
            lessonEl.innerHTML = `
                <div class="flex items-center justify-between mb-4">
                    <h5 class="font-display font-bold text-dark">الدرس ${currentLessons.length}</h5>
                    <button onclick="removeLesson(${lessonId})" class="text-danger hover:text-red-600 transition-colors">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                        </svg>
                    </button>
                </div>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-muted mb-1">عنوان الدرس</label>
                        <input type="text" placeholder="عنوان الدرس" class="lesson-title input-field w-full px-4 py-2 rounded-xl bg-light text-dark placeholder-muted/50"
                            onchange="updateLessonData(${lessonId}, 'title', this.value)">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-muted mb-1">محتوى الدرس</label>
                        <textarea rows="3" placeholder="محتوى الدرس..." class="lesson-content input-field w-full px-4 py-2 rounded-xl bg-light text-dark placeholder-muted/50 resize-none"
                            onchange="updateLessonData(${lessonId}, 'content', this.value)"></textarea>
                    </div>
                    <div class="flex items-center gap-2">
                        <input type="checkbox" id="script-${lessonId}" class="checkbox-custom"
                            onchange="updateLessonData(${lessonId}, 'hasScript', this.checked)">
                        <label for="script-${lessonId}" class="text-sm text-muted">كتابة اسكربت الدرس</label>
                    </div>
                </div>
            `;
            container.appendChild(lessonEl);
        }

        function removeLesson(lessonId) {
            currentLessons = currentLessons.filter(l => l.id !== lessonId);
            document.getElementById(`lesson-${lessonId}`)?.remove();
            
            if (currentLessons.length === 0) {
                document.getElementById('noLessons').classList.remove('hidden');
            }
            
            document.querySelectorAll('.lesson-card h5').forEach((h, i) => {
                h.textContent = `الدرس ${i + 1}`;
            });
        }

        function updateLessonData(lessonId, field, value) {
            const lesson = currentLessons.find(l => l.id === lessonId);
            if (lesson) {
                lesson[field] = value;
            }
        }

        function renderLessons() {
            const container = document.getElementById('lessonsContainer');
            container.innerHTML = '';
            
            if (currentLessons.length === 0) {
                document.getElementById('noLessons').classList.remove('hidden');
                return;
            }
            
            document.getElementById('noLessons').classList.add('hidden');
            
            currentLessons.forEach((lesson, index) => {
                const lessonEl = document.createElement('div');
                lessonEl.className = 'glass rounded-xl p-4 border-2 border-border';
                lessonEl.id = `lesson-${lesson.id}`;
                lessonEl.innerHTML = `
                    <div class="flex items-center justify-between mb-4">
                        <h5 class="font-display font-bold text-dark">الدرس ${index + 1}</h5>
                        <button onclick="removeLesson(${lesson.id})" class="text-danger hover:text-red-600 transition-colors">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                            </svg>
                        </button>
                    </div>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-muted mb-1">عنوان الدرس</label>
                            <input type="text" value="${lesson.title}" placeholder="عنوان الدرس" class="lesson-title input-field w-full px-4 py-2 rounded-xl bg-light text-dark placeholder-muted/50"
                                onchange="updateLessonData(${lesson.id}, 'title', this.value)">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-muted mb-1">محتوى الدرس</label>
                            <textarea rows="3" placeholder="محتوى الدرس..." class="lesson-content input-field w-full px-4 py-2 rounded-xl bg-light text-dark placeholder-muted/50 resize-none"
                                onchange="updateLessonData(${lesson.id}, 'content', this.value)">${lesson.content}</textarea>
                        </div>
                        <div class="flex items-center gap-2">
                            <input type="checkbox" id="script-${lesson.id}" class="checkbox-custom" ${lesson.hasScript ? 'checked' : ''}
                                onchange="updateLessonData(${lesson.id}, 'hasScript', this.checked)">
                            <label for="script-${lesson.id}" class="text-sm text-muted">كتابة اسكربت الدرس</label>
                        </div>
                    </div>
                `;
                container.appendChild(lessonEl);
            });
        }

        function updateCoursePreview() {
            const title = document.getElementById('courseTitle').value || 'عنوان الكورس';
            const shortDesc = document.getElementById('courseShortDesc').value || 'وصف مختصر للكورس';
            const category = document.getElementById('courseCategory').value;
            const price = document.getElementById('coursePrice').value || 0;
            const learningPoints = Array.from(document.querySelectorAll('.learning-point')).map(i => i.value).filter(v => v);
            
            const categoryNames = {
                'irrigation': 'الري والتسميد',
                'protection': 'وقاية النباتات',
                'soil': 'علوم التربة',
                'horticulture': 'البستنة',
                'animal': 'الإنتاج الحيواني',
                'poultry': 'الدواجن',
                'fish': 'الأسماك',
                'organic': 'الزراعة العضوية'
            };
            
            const preview = document.getElementById('previewContent');
            preview.innerHTML = `
                <div class="w-full h-48 bg-gradient-to-br from-primary to-secondary flex items-center justify-center">
                    <svg class="w-16 h-16 text-white/50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                    </svg>
                </div>
                <div class="p-6">
                    <span class="inline-block px-3 py-1 rounded-full bg-primary/10 text-primary text-sm font-medium mb-3">
                        ${category ? categoryNames[category] : 'غير محدد'}
                    </span>
                    <h3 class="font-display text-2xl font-bold text-dark mb-2">${title}</h3>
                    <p class="text-muted mb-4">${shortDesc}</p>
                    <div class="flex items-center justify-between mb-6">
                        <span class="text-2xl font-bold text-primary">${price} ج.م</span>
                        <span class="text-sm text-muted">${currentLessons.length} درس</span>
                    </div>
                    ${learningPoints.length > 0 ? `
                        <div class="mb-6">
                            <h4 class="font-display font-bold text-dark mb-3">ماذا سنتعلم؟</h4>
                            <ul class="space-y-2">
                                ${learningPoints.map(point => `
                                    <li class="flex items-start gap-2">
                                        <svg class="w-5 h-5 text-success flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                                        </svg>
                                        <span class="text-dark">${point}</span>
                                    </li>
                                `).join('')}
                            </ul>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function saveCourseDraft() {
            const course = getCourseData();
            course.status = 'draft';
            
            if (currentCourseId) {
                const index = appData.courses.findIndex(c => c.id === currentCourseId);
                if (index !== -1) {
                    appData.courses[index] = { ...appData.courses[index], ...course };
                }
            } else {
                appData.courses.push(course);
            }
            
            renderCourses();
            closeCourseModal();
            showToast('تم حفظ الكورس كمسودة', 'success');
        }

        function publishCourse() {
            const course = getCourseData();
            course.status = 'published';
            
            if (!course.title) { showToast('يرجى إدخال عنوان الكورس', 'error'); return; }
            if (!course.shortDesc) { showToast('يرجى إدخال وصف مختصر', 'error'); return; }
            if (!course.category) { showToast('يرجى اختيار التخصص', 'error'); return; }
            if (course.price <= 0) { showToast('يرجى إدخال سعر صحيح', 'error'); return; }
            if (course.learningPoints.length === 0) { showToast('يرجى إضافة نقطة تعلم', 'error'); return; }
            
            if (currentCourseId) {
                const index = appData.courses.findIndex(c => c.id === currentCourseId);
                if (index !== -1) {
                    appData.courses[index] = { ...appData.courses[index], ...course };
                }
            } else {
                appData.courses.push(course);
            }
            
            renderCourses();
            closeCourseModal();
            showToast('تم نشر الكورس بنجاح', 'success');
        }

        function getCourseData() {
            return {
                id: currentCourseId || Date.now(),
                title: document.getElementById('courseTitle').value.trim(),
                shortDesc: document.getElementById('courseShortDesc').value.trim(),
                longDesc: document.getElementById('courseLongDesc').value.trim(),
                category: document.getElementById('courseCategory').value,
                price: parseFloat(document.getElementById('coursePrice').value) || 0,
                learningPoints: Array.from(document.querySelectorAll('.learning-point')).map(i => i.value.trim()).filter(v => v),
                image: currentCourseImage,
                video: currentCourseVideo,
                lessons: currentLessons,
                status: 'draft',
                createdAt: new Date().toISOString(),
                students: 0,
                rating: 0,
                reviews: 0
            };
        }

        function deleteCourse(courseId) {
            showDeleteModal('هل أنت متأكد من حذف هذا الكورس؟', function() {
                appData.courses = appData.courses.filter(c => c.id !== courseId);
                appData.tests = appData.tests.filter(t => t.courseId !== courseId);
                appData.comments = appData.comments.filter(c => c.courseId !== courseId);
                appData.reviews = appData.reviews.filter(r => r.courseId !== courseId);
                renderCourses();
                renderTests();
                renderComments();
                renderReviews();
                showToast('تم حذف الكورس بنجاح', 'success');
            });
        }

        function searchCourses(query) {
            const cards = document.querySelectorAll('#coursesList > div');
            cards.forEach(card => {
                const title = card.querySelector('h3')?.textContent.toLowerCase() || '';
                card.style.display = title.includes(query.toLowerCase()) ? '' : 'none';
            });
        }

        function renderCourses() {
            const container = document.getElementById('coursesList');
            
            const categoryNames = {
                'irrigation': 'الري والتسميد',
                'protection': 'وقاية النباتات',
                'soil': 'علوم التربة',
                'horticulture': 'البستنة',
                'animal': 'الإنتاج الحيواني',
                'poultry': 'الدواجن',
                'fish': 'الأسماك',
                'organic': 'الزراعة العضوية'
            };
            
            container.innerHTML = appData.courses.map(course => `
                <div class="glass rounded-2xl overflow-hidden shadow-lg card-hover">
                    <div class="w-full h-40 bg-gradient-to-br from-primary to-secondary flex items-center justify-center">
                        <svg class="w-12 h-12 text-white/50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
                        </svg>
                    </div>
                    <div class="p-5">
                        <div class="flex items-center justify-between mb-3">
                            <span class="px-2 py-1 rounded-full bg-primary/10 text-primary text-xs font-medium">
                                ${categoryNames[course.category] || course.category}
                            </span>
                            <span class="px-2 py-1 rounded-full ${course.status === 'published' ? 'bg-success/10 text-success' : 'bg-warning/10 text-warning'} text-xs font-medium">
                                ${course.status === 'published' ? 'منشور' : 'مسودة'}
                            </span>
                        </div>
                        <h3 class="font-display text-lg font-bold text-dark mb-2">${course.title}</h3>
                        <p class="text-sm text-muted mb-4 line-clamp-2">${course.shortDesc}</p>
                        
                        <div class="flex items-center justify-between text-sm text-muted mb-4">
                            <span>${course.lessons?.length || 0} درس</span>
                            <span>${course.students} طالب</span>
                            ${course.rating > 0 ? `<span>${course.rating.toFixed(1)} <svg class="w-4 h-4 inline text-accent" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg></span>` : '<span class="text-muted/50">بدون تقييم</span>'}
                        </div>
                        
                        <div class="flex items-center justify-between">
                            <span class="text-xl font-bold text-primary">${course.price} ج.م</span>
                            <div class="flex gap-2">
                                <button onclick="openCourseModal(${course.id})" class="p-2 rounded-lg bg-primary/10 text-primary hover:bg-primary/20 transition-colors" title="تعديل">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                                    </svg>
                                </button>
                                <button onclick="deleteCourse(${course.id})" class="p-2 rounded-lg bg-danger/10 text-danger hover:bg-danger/20 transition-colors" title="حذف">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // ============== TESTS ==============
        function openTestModal(testId = null) {
            currentTestId = testId;
            
            const courseSelect = document.getElementById('testCourse');
            courseSelect.innerHTML = '<option value="">اختر الكورس</option>' +
                appData.courses.map(c => `<option value="${c.id}">${c.title}</option>`).join('');
            
            document.getElementById('questionCount').value = 10;
            document.getElementById('questionCountDisplay').textContent = '10';
            document.getElementById('questionsContainer').innerHTML = '';
            
            document.getElementById('testModalTitle').textContent = testId ? 'تعديل الاختبار' : 'إنشاء اختبار جديد';
            
            if (testId) {
                const test = appData.tests.find(t => t.id === testId);
                if (test) {
                    courseSelect.value = test.courseId;
                    document.getElementById('questionCount').value = test.questions.length;
                    document.getElementById('questionCountDisplay').textContent = test.questions.length;
                    generateQuestions(test.questions.length, test.questions);
                }
            }
            
            document.getElementById('testModal').classList.remove('hidden');
        }

        function closeTestModal() {
            document.getElementById('testModal').classList.add('hidden');
        }

        function updateQuestionCount(value) {
            document.getElementById('questionCountDisplay').textContent = value;
            generateQuestions(parseInt(value));
        }

        function generateQuestions(count, existingQuestions = null) {
            const container = document.getElementById('questionsContainer');
            container.innerHTML = '';
            
            for (let i = 0; i < count; i++) {
                const existing = existingQuestions ? existingQuestions[i] : null;
                const questionEl = document.createElement('div');
                questionEl.className = 'glass rounded-xl p-4 border-2 border-border';
                questionEl.innerHTML = `
                    <div class="mb-3">
                        <label class="block text-sm font-medium text-dark mb-2">السؤال ${i + 1}</label>
                        <input type="text" value="${existing ? existing.question : ''}" placeholder="اكتب السؤال هنا..."
                            class="question-text input-field w-full px-4 py-2 rounded-xl bg-light text-dark placeholder-muted/50">
                    </div>
                    <div class="grid grid-cols-2 gap-3 mb-3">
                        ${[0, 1, 2, 3].map(j => `
                            <div class="flex items-center gap-2">
                                <input type="radio" name="correct-${i}" value="${j}" class="w-4 h-4 accent-primary"
                                    ${existing && existing.correctAnswer === j ? 'checked' : ''}>
                                <input type="text" value="${existing ? existing.answers[j] : ''}" placeholder="الإجابة ${j + 1}"
                                    class="answer-text flex-1 input-field px-3 py-1.5 rounded-lg bg-light text-dark placeholder-muted/50 text-sm">
                            </div>
                        `).join('')}
                    </div>
                    <p class="text-xs text-muted">اختر الإجابة الصحيحة</p>
                `;
                container.appendChild(questionEl);
            }
        }

        document.getElementById('testCourse')?.addEventListener('change', function() {
            if (this.value && document.getElementById('questionsContainer').children.length === 0) {
                generateQuestions(10);
            }
        });

        function saveTest() {
            const courseId = parseInt(document.getElementById('testCourse').value);
            
            if (!courseId) {
                showToast('يرجى اختيار الكورس', 'error');
                return;
            }
            
            const questions = [];
            const questionEls = document.getElementById('questionsContainer').children;
            
            for (let i = 0; i < questionEls.length; i++) {
                const el = questionEls[i];
                const questionText = el.querySelector('.question-text').value.trim();
                const answers = Array.from(el.querySelectorAll('.answer-text')).map(a => a.value.trim());
                const correctRadio = el.querySelector(`input[name="correct-${i}"]:checked`);
                
                if (!questionText) {
                    showToast(`يرجى كتابة السؤال ${i + 1}`, 'error');
                    return;
                }
                
                if (answers.some(a => !a)) {
                    showToast(`يرجى إكمال إجابات السؤال ${i + 1}`, 'error');
                    return;
                }
                
                if (!correctRadio) {
                    showToast(`يرجى اختيار الإجابة الصحيحة للسؤال ${i + 1}`, 'error');
                    return;
                }
                
                questions.push({
                    question: questionText,
                    answers: answers,
                    correctAnswer: parseInt(correctRadio.value)
                });
            }
            
            const test = {
                id: currentTestId || Date.now(),
                courseId: courseId,
                questions: questions,
                createdAt: new Date().toISOString()
            };
            
            if (currentTestId) {
                const index = appData.tests.findIndex(t => t.id === currentTestId);
                if (index !== -1) {
                    appData.tests[index] = test;
                }
            } else {
                appData.tests.push(test);
            }
            
            renderTests();
            closeTestModal();
            showToast('تم حفظ الاختبار بنجاح', 'success');
        }

        function deleteTest(testId) {
            showDeleteModal('هل أنت متأكد من حذف هذا الاختبار؟', function() {
                appData.tests = appData.tests.filter(t => t.id !== testId);
                renderTests();
                showToast('تم حذف الاختبار بنجاح', 'success');
            });
        }

        function searchTests(query) {
            const cards = document.querySelectorAll('#testsList > div');
            cards.forEach(card => {
                const title = card.querySelector('h4')?.textContent.toLowerCase() || '';
                card.style.display = title.includes(query.toLowerCase()) ? '' : 'none';
            });
        }

        function renderTests() {
            const container = document.getElementById('testsList');
            
            container.innerHTML = appData.tests.map(test => {
                const course = appData.courses.find(c => c.id === test.courseId);
                return `
                    <div class="glass rounded-2xl p-6 shadow-lg card-hover">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center gap-3">
                                <div class="w-12 h-12 rounded-xl bg-secondary/10 flex items-center justify-center">
                                    <svg class="w-6 h-6 text-secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/>
                                    </svg>
                                </div>
                                <div>
                                    <h4 class="font-display font-bold text-dark">${course ? course.title : 'كورس محذوف'}</h4>
                                    <p class="text-sm text-muted">${test.questions.length} سؤال</p>
                                </div>
                            </div>
                            <div class="flex gap-2">
                                <button onclick="openTestModal(${test.id})" class="p-2 rounded-lg bg-primary/10 text-primary hover:bg-primary/20 transition-colors" title="تعديل">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                                    </svg>
                                </button>
                                <button onclick="deleteTest(${test.id})" class="p-2 rounded-lg bg-danger/10 text-danger hover:bg-danger/20 transition-colors" title="حذف">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <p class="text-sm text-muted">تم الإنشاء: ${new Date(test.createdAt).toLocaleDateString('ar-EG')}</p>
                    </div>
                `;
            }).join('');
        }

        // ============== COMMENTS ==============
        function openReplyModal(commentId) {
            currentCommentId = commentId;
            const comment = appData.comments.find(c => c.id === commentId);
            if (!comment) return;
            
            document.getElementById('originalComment').innerHTML = `
                <div class="flex items-center gap-2 mb-2">
                    <span class="font-medium text-dark">${comment.userName}</span>
                    <span class="text-xs text-muted">${new Date(comment.createdAt).toLocaleDateString('ar-EG')}</span>
                </div>
                <p class="text-dark">${comment.text}</p>
            `;
            
            document.getElementById('replyText').value = comment.reply || '';
            document.getElementById('replyModal').classList.remove('hidden');
        }

        function closeReplyModal() {
            document.getElementById('replyModal').classList.add('hidden');
        }

        function submitReply() {
            const reply = document.getElementById('replyText').value.trim();
            if (!reply) {
                showToast('يرجى كتابة الرد', 'error');
                return;
            }
            
            const comment = appData.comments.find(c => c.id === currentCommentId);
            if (comment) {
                comment.reply = reply;
                renderComments();
                closeReplyModal();
                showToast('تم إرسال الرد بنجاح', 'success');
            }
        }

        function likeComment(commentId) {
            const comment = appData.comments.find(c => c.id === commentId);
            if (comment) {
                comment.likes = (comment.likes || 0) + 1;
                renderComments();
                showToast('تم تسجيل الإعجاب', 'success');
            }
        }

        function deleteComment(commentId) {
            showDeleteModal('هل أنت متأكد من حذف هذا التعليق؟', function() {
                appData.comments = appData.comments.filter(c => c.id !== commentId);
                renderComments();
                showToast('تم حذف التعليق بنجاح', 'success');
            });
        }

        function renderComments() {
            const container = document.getElementById('commentsList');
            
            container.innerHTML = appData.comments.map(comment => `
                <div class="glass rounded-xl p-5 shadow-lg">
                    <div class="flex items-start justify-between mb-3">
                        <div>
                            <h4 class="font-medium text-dark">${comment.userName}</h4>
                            <p class="text-xs text-muted">${comment.courseName} - ${comment.lessonName}</p>
                        </div>
                        <span class="text-xs text-muted">${new Date(comment.createdAt).toLocaleDateString('ar-EG')}</span>
                    </div>
                    
                    <p class="text-dark mb-4">${comment.text}</p>
                    
                    ${comment.reply ? `
                        <div class="bg-primary/5 rounded-lg p-3 mb-4 border-r-2 border-primary">
                            <p class="text-sm text-muted mb-1">ردك:</p>
                            <p class="text-dark">${comment.reply}</p>
                        </div>
                    ` : ''}
                    
                    <div class="flex items-center gap-3">
                        <button onclick="likeComment(${comment.id})" class="flex items-center gap-1 text-sm text-muted hover:text-primary transition-colors">
                            <svg class="w-4 h-4" fill="${comment.likes > 0 ? 'currentColor' : 'none'}" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 10h4.764a2 2 0 011.789 2.894l-3.5 7A2 2 0 0115.263 21h-4.017c-.163 0-.326-.02-.485-.06L7 20m7-10V5a2 2 0 00-2-2h-.095c-.5 0-.905.405-.905.905 0 .714-.211 1.412-.608 2.006L7 11v9m7-10h-2M7 20H5a2 2 0 01-2-2v-6a2 2 0 012-2h2.5"/>
                            </svg>
                            <span>${comment.likes || 0}</span>
                        </button>
                        <button onclick="openReplyModal(${comment.id})" class="text-sm text-primary font-medium hover:text-secondary transition-colors">
                            ${comment.reply ? 'تعديل الرد' : 'رد'}
                        </button>
                        <button onclick="deleteComment(${comment.id})" class="text-sm text-danger font-medium hover:text-red-600 transition-colors mr-auto">
                            حذف
                        </button>
                    </div>
                </div>
            `).join('');
            
            // Update badge
            const unreadCount = appData.comments.filter(c => !c.reply).length;
            const badge = document.getElementById('commentsBadge');
            badge.textContent = unreadCount;
            badge.style.display = unreadCount > 0 ? '' : 'none';
        }

        // ============== REVIEWS ==============
        function renderReviews() {
            const container = document.getElementById('reviewsList');
            
            // Group by course
            const courseReviews = {};
            appData.reviews.forEach(review => {
                if (!courseReviews[review.courseId]) {
                    courseReviews[review.courseId] = [];
                }
                courseReviews[review.courseId].push(review);
            });
            
            container.innerHTML = Object.entries(courseReviews).map(([courseId, reviews]) => {
                const course = appData.courses.find(c => c.id === parseInt(courseId));
                const avgRating = (reviews.reduce((sum, r) => sum + r.rating, 0) / reviews.length).toFixed(1);
                
                return `
                    <div class="glass rounded-2xl p-6 shadow-lg">
                        <div class="flex items-center justify-between mb-4">
                            <h4 class="font-display text-lg font-bold text-dark">${course ? course.title : 'كورس محذوف'}</h4>
                            <div class="flex items-center gap-2 bg-accent/10 px-4 py-2 rounded-xl">
                                <svg class="w-6 h-6 text-accent" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                                </svg>
                                <span class="text-2xl font-bold text-dark">${avgRating}</span>
                                <span class="text-sm text-muted">(${reviews.length} تقييم)</span>
                            </div>
                        </div>
                        
                        <div class="space-y-3">
                            ${reviews.map(review => `
                                <div class="flex items-start gap-3 p-3 bg-light rounded-lg">
                                    <div class="flex-shrink-0">
                                        ${renderStars(review.rating)}
                                    </div>
                                    <div class="flex-1">
                                        <p class="text-sm text-dark">${review.text || 'بدون تعليق'}</p>
                                        <p class="text-xs text-muted mt-1">${review.userName} - ${new Date(review.createdAt).toLocaleDateString('ar-EG')}</p>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderStars(rating) {
            let stars = '';
            for (let i = 1; i <= 5; i++) {
                if (i <= rating) {
                    stars += '<svg class="w-4 h-4 text-accent inline" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>';
                } else {
                    stars += '<svg class="w-4 h-4 text-muted/30 inline" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>';
                }
            }
            return stars;
        }

        // ============== EARNINGS ==============
        function initWithdrawMethod() {
            document.getElementById('withdrawMethod')?.addEventListener('change', function() {
                const details = document.getElementById('withdrawDetails');
                const visa = document.getElementById('visaFields');
                const paypal = document.getElementById('paypalFields');
                const vodafone = document.getElementById('vodafoneFields');
                
                details.classList.remove('hidden');
                visa.classList.add('hidden');
                paypal.classList.add('hidden');
                vodafone.classList.add('hidden');
                
                switch(this.value) {
                    case 'visa': visa.classList.remove('hidden'); break;
                    case 'paypal': paypal.classList.remove('hidden'); break;
                    case 'vodafone': vodafone.classList.remove('hidden'); break;
                    default: details.classList.add('hidden');
                }
            });
        }

        function requestWithdraw() {
            const method = document.getElementById('withdrawMethod').value;
            const amount = parseFloat(document.getElementById('withdrawAmount').value);
            
            if (!method) {
                showToast('يرجى اختيار طريقة السحب', 'error');
                return;
            }
            
            if (!amount || amount <= 0) {
                showToast('يرجى إدخال مبلغ صحيح', 'error');
                return;
            }
            
            appData.transactions.push({
                id: Date.now(),
                type: 'withdraw',
                method: method,
                amount: amount,
                status: 'pending',
                createdAt: new Date().toISOString(),
                description: 'طلب سحب جديد'
            });
            
            renderTransactions();
            document.getElementById('withdrawMethod').value = '';
            document.getElementById('withdrawAmount').value = '';
            document.getElementById('withdrawDetails').classList.add('hidden');
            
            showToast('تم تقديم طلب السحب بنجاح', 'success');
        }

        function renderTransactions() {
            const container = document.getElementById('transactionsList');
            
            const methodNames = {
                'visa': 'فيزا / ماستركارد',
                'paypal': 'باي بال',
                'vodafone': 'فودافون كاش'
            };
            
            container.innerHTML = appData.transactions.map(t => `
                <div class="flex items-center justify-between p-4 bg-light rounded-xl">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-lg ${t.type === 'withdraw' ? 'bg-danger/10' : 'bg-success/10'} flex items-center justify-center">
                            <svg class="w-5 h-5 ${t.type === 'withdraw' ? 'text-danger' : 'text-success'}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                ${t.type === 'withdraw' 
                                    ? '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"/>'
                                    : '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>'}
                            </svg>
                        </div>
                        <div>
                            <p class="font-medium text-dark">${t.description || (t.type === 'withdraw' ? 'سحب' : 'إيداع')}</p>
                            <p class="text-xs text-muted">${methodNames[t.method] || ''} - ${new Date(t.createdAt).toLocaleDateString('ar-EG')}</p>
                        </div>
                    </div>
                    <div class="text-left">
                        <p class="font-bold ${t.type === 'withdraw' ? 'text-danger' : 'text-success'}">${t.type === 'withdraw' ? '-' : '+'}${t.amount} ج.م</p>
                        <span class="text-xs px-2 py-0.5 rounded-full ${t.status === 'pending' ? 'bg-warning/10 text-warning' : 'bg-success/10 text-success'}">
                            ${t.status === 'pending' ? 'قيد المراجعة' : 'مكتمل'}
                        </span>
                    </div>
                </div>
            `).join('');
        }

        // ============== DELETE MODAL ==============
        function showDeleteModal(message, callback) {
            document.getElementById('deleteMessage').textContent = message;
            deleteCallback = callback;
            document.getElementById('confirmDeleteBtn').onclick = function() {
                if (deleteCallback) deleteCallback();
                closeDeleteModal();
            };
            document.getElementById('deleteModal').classList.remove('hidden');
        }

        function closeDeleteModal() {
            document.getElementById('deleteModal').classList.add('hidden');
            deleteCallback = null;
        }

        // ============== TOAST ==============
        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            
            const colors = { 'success': 'bg-success', 'error': 'bg-danger', 'warning': 'bg-warning', 'info': 'bg-primary' };
            const icons = {
                'success': '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>',
                'error': '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>',
                'warning': '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>',
                'info': '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>'
            };
            
            toast.className = `toast ${colors[type]} text-white px-4 py-3 rounded-xl shadow-lg flex items-center gap-2 min-w-64`;
            toast.innerHTML = `
                <svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">${icons[type]}</svg>
                <span>${message}</span>
            `;
            
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateX(-100%)';
                toast.style.transition = 'all 0.3s ease';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // ============== RENDER ALL ==============
        function renderAll() {
            renderCourses();
            renderTests();
            renderComments();
            renderReviews();
            renderTransactions();
        }
    </script>
</body>
</html>